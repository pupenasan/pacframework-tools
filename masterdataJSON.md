# Структура JSON файлів Master Data

JSON файли Master Data слугують для збереження даних Master Data для їх імпорту/експорту в/з masterdata-tools або інших інструментів.

## CFG Файли експорту з інструментів проектування 

Даний тип файлів має префікс `cfg_` і слугує для проміжного збереження майстерданих, що експортуються з інструментів проектування. По факту тільки один файл `cfg_tags.json` - є експортним варіантом, усі інші генеруються на базі нього.  Цими інструментами можуть бути будь які сторонні засоби.  `masterdata-tools` має вбудовані утиліти для експорту з:

-  [Файлів Excel xlsx](masredataxls.md) 

Користувач може використовувати інші інструменти, тоді він повинен забезпечити збереження експортних даних `cfg_tags` в форматі, що описаний нижче. 

### cfg_tags

Зберігає дані про теги. Це вихідний файл для всіх даних (НЕ ТАК, за необхідності імпорту з інших тулзів треба буде адаптувати!!!) Має наступні поля-об'єкти:

- **tags** - вся інформація про технологічні змінні, та всією інформацією, що має до них відношення 
- **ids** - валідні tagname за id; це обєкт, містить властивості з назвою ID технологічної змінної і значенням  

```json
"ids": {"1": "HBK10_CP001",}
```

- **invalids** - невалідні tagname за id, структура так ж як у `ids`
- **statistic** - кількість для кожного типу тегів

```json
"statistic" : {"AI": {"count" : 32},"DI": {"count" : 128}, }
```

- **memmap** -  налаштування адрес для змінних, якщо вони повинні записуватися в програму ПЛК

#### tags

id: числовий ідентифікатор технологічної змінної

tagname: ім'я технологічної змінної 

description: опис технологічної змінної 

props: усі властивості для тегу, перелік полів вказаний в [описі формату даних в Excel xlsx](masterdataxls.md) 

state: valid/inv_noname/inv_duplname/inv_name/inv_id/inv_duplid - стан валдіності технологічної змінної

Приклад структури тега в форматі JSON наведений нижче:

```json
"tags": {
    "L1_FT101": {	
        "state": "valid"
        "tagname": "L1_FT101"
        "id":	1
        "props": {	
            "ID": 1
            "TAGNAME": "L1_FT101"
            "DESCRIPTION": "FT1-101 Витрата води"
            "TYPE": "AI"
            "DEV": "R0"
            "SRCADR":"%IW0.4.0"
            "MODNMB": 4
            "CH: 0
            "CHID":1
            "SUBTYPE": "4-20mA"
            "UNIT":"m3/h"
            "FRMT":"s99.99"
            "SCALE": "(3,54..50)"
            "MODNM":"AMI0810"
            "MODID": "R0_AMI0810_4"
    	}
        "description":"FT1-101 Витрата води"
    },
}
```



### cfg_chs

### cfg_chmap

### cfg_acts



## PLC Файли експорту з середовищ розроблення PLC

### plc_tags

Має наступні поля-об'єкти:

- **types** - вся інформація про типи даних для технологічних змінних, що витягнута з ПЛК. Опис структури нижче. 

- **tags** - вся інформація витягнута з ПЛК про технологічні змінні. Опис структури нижче. 

- **ids** - обєкт, індексація за ID. Містить властивості з назвою ID технологічної змінної і значенням  

```json
"ids": {"1": "HBK10_CP001",}
```

- **twinsrepo** - індексація за CLSID:ID. Потрібен для IoTGateway для звернення до бази даних цифрового двійника за CLSID:ID. Наприклад CLSID=4112 (1010h) та ID=10001:

```json
"twinsrepo": {
		"4112": {
			"10001": {
                "ref": "tags/CJF01_GW001_DCOK",
				"reftype": "var",
				"alias": "CJF01_GW001_DCOK"
			},
        },
}    
```

ref - посилання на відповідний об'єкт в репозиторії, тут завжди var 

reftype - тип об'єкту, тут є іменем тегу 

alias - псевдонім об'єкту 

- **memmap** - образ адресованої пам'яті з посиланням на відповідні обєкти. У випадку блокової адресації має структуру `номер_або_назва_блоку.номер_або_назва_адресиПЛК: "посилання_на_тег_мастерданих" `  

```json
"memmap": {
		"3": {
			"84": "varbuf"
		},
		"6": {
			"0": "tags.HBK10_CP001.plchmi",
			"8": "tags.HNA10_CT002.plchmi",
        },
}
```

- **varbuf** -  вся інформація витягнута з ПЛК про буфер для технологічної змінної. Опис структури нижче. 

#### types



#### tags



#### varbuf